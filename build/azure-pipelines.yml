name: $(BuildID).$(Date:yyMMdd)$(Rev:.r)

trigger:
- master

variables:
  nodeVersion: '>=10.15.3'

jobs:
- job: Windows
  pool:
    vmImage: 'windows-2019'
    demands: npm
  steps:
    - script: |
        set
      displayName: 'Dump environment variables'
      condition: eq(variables['system.debug'], 'true')

    - task: NodeTool@0
      displayName: 'Use Node version: $(nodeVersion)'
      inputs:
        versionSpec: $(nodeVersion)

    - task: Npm@1
      displayName: 'Install dependencies with package-lock.json'
      inputs:
        command: custom
        verbose: true
        customCommand: |
          ci

    - task: Npm@1
      displayName: 'Compile sources'
      inputs:
        command: custom
        verbose: true
        customCommand: |
          run buildOnce

    - script: |
        node node_modules/vscode/bin/test
      displayName: 'Run tests'
